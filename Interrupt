#define F_CPU 16000000

#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#define TIMER_SETUP_H_

int main(void){
	sei();											//Enable interrupts
    DDRB = (1 << PORTB0) | (1 << PORTB1);			//PB0 (LED) og PB1/OC1A (Timer) som output
	
	PORTD = (1 << PORTD2);							//Intern resistor
	
	EIMSK = (1 << INT0);							//Enable INT0
	

	// 1024x prescaler (set CS12 & CS10) and CTC mode with OCR1A top (mode 4 - set WGM12)
	// This gives 16e6/1024 = 15625 ticks pr. second
	TCCR1B = (1 << WGM12) | (1 << CS12) | (1 << CS10);
	
    while (1){
		_delay_ms(500);
	}
    
}

ISR(INT0_vect){						//INT0 funksjon
	
	_delay_ms(500);					//Debouncing
	PORTB ^= (1 << PORTB0);			//Toggle LED
	
	if (bit_is_set(PORTB,PB0)){		//Enable timer og set timer til 500ms
		TCCR1A = (1 << COM1A0);
		OCR1A = ((F_CPU / 1024) * 500) / 1000;
	}
	if (bit_is_clear(PORTB,PB0)){	//Disable timer
		TCCR1A = 0; 
	} 
}
